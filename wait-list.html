<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Signup Process</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Configure Tailwind to use the Inter font */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f7f9fc;
    }
    
    /* Standard Input and Select styling consistency */
    input[type="text"], input[type="email"], input[type="password"], select, input[type="tel"] {
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        width: 100%;
        box-sizing: border-box;
        transition: border-color 0.2s;
    }
    input:focus, select:focus {
        border-color: #3b82f6;
        outline: none;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
    }

    /* Tag Styling */
    .tag {
        display: inline-block;
        background-color: #e5e7eb;
        color: #4b5563;
        padding: 0.5rem 1rem;
        margin: 0.35rem;
        border-radius: 9999px;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s, transform 0.1s;
        font-size: 0.875rem;
        user-select: none;
        border: 1px solid #d1d5db;
    }
    .tag:hover {
        background-color: #d1d5db;
    }
    .tag.selected {
        background-color: #3b82f6;
        color: white;
        border-color: #3b82f6;
        transform: scale(1.03);
    }

    /* Modal Styling */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.75);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }
    .modal-overlay.open {
        display: flex;
    }
    .modal-content {
        max-height: 80vh;
        overflow-y: auto;
    }
</style>

</head>
<body class="p-4 sm:p-6 md:p-8">

<div class="max-w-xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl space-y-6">

    <div id="profileView">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Tell us about yourself so we can properly match you with people of like minds</h2>

        <form id="signupForm" class="space-y-6">

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">WhatsApp Number:</label>
                <div class="flex space-x-2">
                    <select id="countryCode" name="countryCode" class="w-1/3" required>
                        <option value="">Code</option>
                    </select>
                    <input type="tel" id="whatsappNumber" name="whatsappNumber" placeholder="Enter local number" class="w-2/3" required>
                </div>
            </div>

            <div>
                <label for="fullname" class="block text-sm font-medium text-gray-700 mb-1">Full Name:</label>
                <input type="text" id="fullname" name="fullname" placeholder="Enter your full name" required>
            </div>
            
            <div>
                <label for="nickname" class="block text-sm font-medium text-gray-700 mb-1">Nickname:</label>
                <input type="text" id="nickname" name="nickname" placeholder="Your WhatsApp Name" required>
                <small class="text-xs text-gray-500 mt-1 block">
                    **This is the name your new status viewers will see you as on Whatsapp**
                </small>
            </div>

            <div>
                <label for="profession" class="block text-sm font-medium text-gray-700 mb-1">Profession:</label>
                <input type="text" id="profession" name="profession" placeholder="e.g., Software Engineer, Marketer, Student" required>
                <small class="text-xs text-gray-500 mt-1 block">
                    **This will be added to your nickname on Whatsapp to signify what you do so that potential customers can easily identify you (e.g., Moses (Doctor)). You should be able to turn this off later in settings.**
                </small>
            </div>

            <h2 class="text-xl font-semibold text-gray-800 pt-4 border-t border-gray-200">Tell Us About Yourself</h2>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700 mb-1">Age:</label>
                    <select id="age" name="age" required>
                        <option value="">Select Age</option>
                    </select>
                </div>

                <div>
                    <label for="gender" class="block text-sm font-medium text-gray-700 mb-1">Gender:</label>
                    <select id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
            </div>

            <div>
                <label for="country" class="block text-sm font-medium text-gray-700 mb-1">Country:</label>
                <select id="country" name="country" required>
                    <option value="">Loading Countries...</option>
                </select>
            </div>

            <div>
                <label for="state" class="block text-sm font-medium text-gray-700 mb-1">State/Region:</label>
                <select id="state" name="state" required disabled>
                    <option value="">Select a Country first</option>
                </select>
            </div>

            <div>
                <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City/Town:</label>
                <select id="city" name="city" required disabled>
                    <option value="">Select a State/Region first</option>
                </select>
            </div>

            <h3 class="text-lg font-semibold text-gray-800 pt-4 border-t border-gray-200">Hobbies and Interests</h3>
            <p class="text-sm text-gray-600 mb-2">Select all that apply:</p>
            <div id="hobbiesContainer" class="flex flex-wrap -m-1 p-1 bg-gray-50 rounded-lg"></div>

            <h3 class="text-lg font-semibold text-gray-800 pt-4 border-t border-gray-200">RECOMMEND ME TO CUSTOMERS WHO NEED</h3>
            <p class="text-sm text-gray-600 mb-2">Select the services you provide:</p>
            <div id="customersContainer" class="flex flex-wrap -m-1 p-1 bg-gray-50 rounded-lg"></div>

            <h3 class="text-lg font-semibold text-gray-800 pt-4 border-t border-gray-200">RECOMMEND ME TO NEARBY FRIENDS FOR</h3>
            <p class="text-sm text-gray-600 mb-2">Select reasons a friend may refer you:</p>
            <div id="friendsContainer" class="flex flex-wrap -m-1 p-1 bg-gray-50 rounded-lg"></div>

            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150 ease-in-out shadow-md hover:shadow-lg">
                Continue
            </button>

        </form>
    </div>

    <div id="credentialsView" class="hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Create Your Account Credentials</h2>

        <form id="credentialsForm" class="space-y-6">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email:</label>
                <input type="email" id="email" name="email" placeholder="Enter your email" required>
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password:</label>
                <input type="password" id="password" name="password" placeholder="Enter your password" required>
            </div>

            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150 ease-in-out shadow-md hover:shadow-lg">
                Sign Up
            </button>
            <button type="button" onclick="goToProfileView()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg transition duration-150 ease-in-out shadow-md hover:shadow-lg mt-2">
                &larr; Back to Profile
            </button>
        </form>
    </div>

</div>

<div id="systemModal" class="modal-overlay">
    <div class="modal-content bg-white p-8 rounded-xl shadow-2xl w-11/12 max-w-lg">
        <h3 id="modalTitle" class="text-2xl font-bold text-green-600 mb-4"></h3>
        <p id="modalMessage" class="text-gray-700 mb-4"></p>
        <div id="finalData" class="bg-gray-100 p-4 rounded-lg text-sm whitespace-pre-wrap hidden"></div>
        <button onclick="document.getElementById('systemModal').style.display='none'" class="mt-6 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 rounded-lg">
            Close
        </button>
    </div>
</div>


<script>
    // --- Global State and Data Storage ---
    let profileData = {};
    // Store all location data loaded from the R2 file
    let locationData = []; 
    // Store states for the currently selected country
    let selectedCountryStates = []; 
    
    const selectedHobbies = new Set();
    const selectedServices = new Set();
    const selectedFriends = new Set();

    // The reliable R2 URL for your large JSON file!
    const R2_URL = 'https://pub-48a1c3e270fd40b49240608e1549146c.r2.dev/location_data.json';
    
    // Comprehensive Country Codes Data (Used for phone codes and initial country list)
    const phoneCodes = [
        // Your full phoneCodes list is retained here...
        { name: "Afghanistan", code: "+93", iso2: "AF", placeholder: "e.g., 70 123 4567" },
        { name: "Albania", code: "+355", iso2: "AL", placeholder: "e.g., 69 123 4567" },
        { name: "Algeria", code: "+213", iso2: "DZ", placeholder: "e.g., 700 123 456" },
        { name: "Andorra", code: "+376", iso2: "AD", placeholder: "e.g., 345 678" },
        { name: "Angola", code: "+244", iso2: "AO", placeholder: "e.g., 923 123 456" },
        { name: "Antarctica", code: "+672", iso2: "AQ", placeholder: "e.g., 112 345" },
        { name: "Argentina", code: "+54", iso2: "AR", placeholder: "e.g., 9 11 1234 5678" },
        { name: "Armenia", code: "+374", iso2: "AM", placeholder: "e.g., 91 123 456" },
        { name: "Aruba", code: "+297", iso2: "AW", placeholder: "e.g., 555 1234" },
        { name: "Australia", code: "+61", iso2: "AU", placeholder: "e.g., 412 345 678" },
        { name: "Austria", code: "+43", iso2: "AT", placeholder: "e.g., 664 123 4567" },
        { name: "Azerbaijan", code: "+994", iso2: "AZ", placeholder: "e.g., 50 123 4567" },
        { name: "Bahamas", code: "+1-242", iso2: "BS", placeholder: "e.g., 300 1234" },
        { name: "Bahrain", code: "+973", iso2: "BH", placeholder: "e.g., 39 123456" },
        { name: "Bangladesh", code: "+880", iso2: "BD", placeholder: "e.g., 171 123 4567" },
        { name: "Barbados", code: "+1-246", iso2: "BB", placeholder: "e.g., 230 1234" },
        { name: "Belarus", code: "+375", iso2: "BY", placeholder: "e.g., 29 123 4567" },
        { name: "Belgium", code: "+32", iso2: "BE", placeholder: "e.g., 475 12 34 56" },
        { name: "Belize", code: "+501", iso2: "BZ", placeholder: "e.g., 600 1234" },
        { name: "Benin", code: "+229", iso2: "BJ", placeholder: "e.g., 95 12 34 56" },
        { name: "Bhutan", code: "+975", iso2: "BT", placeholder: "e.g., 17 12 34 56" },
        { name: "Bolivia", code: "+591", iso2: "BO", placeholder: "e.g., 700 12345" },
        { name: "Bosnia and Herzegovina", code: "+387", iso2: "BA", placeholder: "e.g., 61 123 456" },
        { name: "Botswana", code: "+267", iso2: "BW", placeholder: "e.g., 71 123 456" },
        { name: "Brazil", code: "+55", iso2: "BR", placeholder: "e.g., 11 91234 5678" },
        { name: "Brunei", code: "+673", iso2: "BN", placeholder: "e.g., 812 3456" },
        { name: "Bulgaria", code: "+359", iso2: "BG", placeholder: "e.g., 88 123 4567" },
        { name: "Burkina Faso", code: "+226", iso2: "BF", placeholder: "e.g., 70 12 34 56" },
        { name: "Burundi", code: "+257", iso2: "BI", placeholder: "e.g., 79 12 34 56" },
        { name: "Cambodia", code: "+855", iso2: "KH", placeholder: "e.g., 92 123 456" },
        { name: "Cameroon", code: "+237", iso2: "CM", placeholder: "e.g., 670 12 34 56" },
        { name: "Canada", code: "+1", iso2: "CA", placeholder: "e.g., (416) 987-6543" },
        { name: "Cape Verde", code: "+238", iso2: "CV", placeholder: "e.g., 912 34 56" },
        { name: "Central African Republic", code: "+236", iso2: "CF", placeholder: "e.g., 70 12 34 56" },
        { name: "Chad", code: "+235", iso2: "TD", placeholder: "e.g., 66 12 34 56" },
        { name: "Chile", code: "+56", iso2: "CL", placeholder: "e.g., 9 1234 5678" },
        { name: "China", code: "+86", iso2: "CN", placeholder: "e.g., 138 1234 5678" },
        { name: "Colombia", code: "+57", iso2: "CO", placeholder: "e.g., 300 1234567" },
        { name: "Comoros", code: "+269", iso2: "KM", placeholder: "e.g., 32 123 45" },
        { name: "Congo (DRC)", code: "+243", iso2: "CD", placeholder: "e.g., 81 123 4567" },
        { name: "Congo (Republic)", code: "+242", iso2: "CG", placeholder: "e.g., 06 123 4567" },
        { name: "Costa Rica", code: "+506", iso2: "CR", placeholder: "e.g., 8888 1234" },
        { name: "Croatia", code: "+385", iso2: "HR", placeholder: "e.g., 91 123 4567" },
        { name: "Cuba", code: "+53", iso2: "CU", placeholder: "e.g., 5 123 4567" },
        { name: "Cyprus", code: "+357", iso2: "CY", placeholder: "e.g., 99 123456" },
        { name: "Czech Republic", code: "+420", iso2: "CZ", placeholder: "e.g., 602 123 456" },
        { name: "Denmark", code: "+45", iso2: "DK", placeholder: "e.g., 12 34 56 78" },
        { name: "Djibouti", code: "+253", iso2: "DJ", placeholder: "e.g., 77 12 34 56" },
        { name: "Dominica", code: "+1-767", iso2: "DM", placeholder: "e.g., 230 1234" },
        { name: "Dominican Republic", code: "+1-809", iso2: "DO", placeholder: "e.g., 809 123 4567" },
        { name: "Ecuador", code: "+593", iso2: "EC", placeholder: "e.g., 9 123 4567" },
        { name: "Egypt", code: "+20", iso2: "EG", placeholder: "e.g., 100 123 4567" },
        { name: "El Salvador", code: "+503", iso2: "SV", placeholder: "e.g., 7000 1234" },
        { name: "Equatorial Guinea", code: "+240", iso2: "GQ", placeholder: "e.g., 222 123 456" },
        { name: "Eritrea", code: "+291", iso2: "ER", placeholder: "e.g., 1 123 456" },
        { name: "Estonia", code: "+372", iso2: "EE", placeholder: "e.g., 50 123 456" },
        { name: "Eswatini (Swaziland)", code: "+268", iso2: "SZ", placeholder: "e.g., 76 123 456" },
        { name: "Ethiopia", code: "+251", iso2: "ET", placeholder: "e.g., 91 123 4567" },
        { name: "Fiji", code: "+679", iso2: "FJ", placeholder: "e.g., 92 12345" },
        { name: "Finland", code: "+358", iso2: "FI", placeholder: "e.g., 40 123 4567" },
        { name: "France", code: "+33", iso2: "FR", placeholder: "e.g., 6 12 34 56 78" },
        { name: "Gabon", code: "+241", iso2: "GA", placeholder: "e.g., 07 12 34 56" },
        { name: "Gambia", code: "+220", iso2: "GM", placeholder: "e.g., 700 1234" },
        { name: "Georgia", code: "+995", iso2: "GE", placeholder: "e.g., 555 12 34 56" },
        { name: "Germany", code: "+49", iso2: "DE", placeholder: "e.g., 171 1234567" },
        { name: "Ghana", code: "+233", iso2: "GH", placeholder: "e.g., 551234567" },
        { name: "Greece", code: "+30", iso2: "GR", placeholder: "e.g., 694 123 4567" },
        { name: "Greenland", code: "+299", iso2: "GL", placeholder: "e.g., 55 12 34" },
        { name: "Guatemala", code: "+502", iso2: "GT", placeholder: "e.g., 5000 1234" },
        { name: "Guinea", code: "+224", iso2: "GN", placeholder: "e.g., 620 12 34 56" },
        { name: "Guinea-Bissau", code: "+245", iso2: "GW", placeholder: "e.g., 95 123 4567" },
        { name: "Guyana", code: "+592", iso2: "GY", placeholder: "e.g., 620 1234" },
        { name: "Haiti", code: "+509", iso2: "HT", placeholder: "e.g., 34 12 3456" },
        { name: "Honduras", code: "+504", iso2: "HN", placeholder: "e.g., 9000 1234" },
        { name: "Hungary", code: "+36", iso2: "HU", placeholder: "e.g., 30 123 4567" },
        { name: "Iceland", code: "+354", iso2: "IS", placeholder: "e.g., 812 3456" },
        { name: "India", code: "+91", iso2: "IN", placeholder: "e.g., 98765 43210" },
        { name: "Indonesia", code: "+62", iso2: "ID", placeholder: "e.g., 812 3456 7890" },
        { name: "Iran", code: "+98", iso2: "IR", placeholder: "e.g., 912 123 4567" },
        { name: "Iraq", code: "+964", iso2: "IQ", placeholder: "e.g., 770 123 4567" },
        { name: "Ireland", code: "+353", iso2: "IE", placeholder: "e.g., 86 123 4567" },
        { name: "Israel", code: "+972", iso2: "IL", placeholder: "e.g., 50 123 4567" },
        { name: "Italy", code: "+39", iso2: "IT", placeholder: "e.g., 333 123 4567" },
        { name: "Ivory Coast (Côte d'Ivoire)", code: "+225", iso2: "CI", placeholder: "e.g., 07 12 34 56 78" },
        { name: "Jamaica", code: "+1-876", iso2: "JM", placeholder: "e.g., 876 123 4567" },
        { name: "Japan", code: "+81", iso2: "JP", placeholder: "e.g., 90 1234 5678" },
        { name: "Jordan", code: "+962", iso2: "JO", placeholder: "e.g., 79 123 4567" },
        { name: "Kazakhstan", code: "+7", iso2: "KZ", placeholder: "e.g., 700 123 4567" },
        { name: "Kenya", code: "+254", iso2: "KE", placeholder: "e.g., 700 123 456" },
        { name: "Kuwait", code: "+965", iso2: "KW", placeholder: "e.g., 99 123 456" },
        { name: "Kyrgyzstan", code: "+996", iso2: "KG", placeholder: "e.g., 777 123 456" },
        { name: "Laos", code: "+856", iso2: "LA", placeholder: "e.g., 20 123 4567" },
        { name: "Latvia", code: "+371", iso2: "LV", placeholder: "e.g., 20 123 456" },
        { name: "Lebanon", code: "+961", iso2: "LB", placeholder: "e.g., 3 123 456" },
        { name: "Lesotho", code: "+266", iso2: "LS", placeholder: "e.g., 58 123 456" },
        { name: "Liberia", code: "+231", iso2: "LR", placeholder: "e.g., 77 123 456" },
        { name: "Libya", code: "+218", iso2: "LY", placeholder: "e.g., 91 123 4567" },
        { name: "Liechtenstein", code: "+423", iso2: "LI", placeholder: "e.g., 79 123 4567" },
        { name: "Lithuania", code: "+370", iso2: "LT", placeholder: "e.g., 611 12345" },
        { name: "Luxembourg", code: "+352", iso2: "LU", placeholder: "e.g., 621 123 456" },
        { name: "Madagascar", code: "+261", iso2: "MG", placeholder: "e.g., 32 12 345 67" },
        { name: "Malawi", code: "+265", iso2: "MW", placeholder: "e.g., 999 12 34 56" },
        { name: "Malaysia", code: "+60", iso2: "MY", placeholder: "e.g., 12 123 4567" },
        { name: "Maldives", code: "+960", iso2: "MV", placeholder: "e.g., 777 1234" },
        { name: "Mali", code: "+223", iso2: "ML", placeholder: "e.g., 66 12 34 56" },
        { name: "Malta", code: "+356", iso2: "MT", placeholder: "e.g., 99 12 34 56" },
        { name: "Mauritania", code: "+222", iso2: "MR", placeholder: "e.g., 40 12 34 56" },
        { name: "Mauritius", code: "+230", iso2: "MU", placeholder: "e.g., 5250 1234" },
        { name: "Mexico", code: "+52", iso2: "MX", placeholder: "e.g., 55 1234 5678" },
        { name: "Moldova", code: "+373", iso2: "MD", placeholder: "e.g., 69 123 456" },
        { name: "Monaco", code: "+377", iso2: "MC", placeholder: "e.g., 6 12 34 56 78" },
        { name: "Mongolia", code: "+976", iso2: "MN", placeholder: "e.g., 99 123 456" },
        { name: "Montenegro", code: "+382", iso2: "ME", placeholder: "e.g., 67 123 456" },
        { name: "Morocco", code: "+212", iso2: "MA", placeholder: "e.g., 6 12 34 56 78" },
        { name: "Mozambique", code: "+258", iso2: "MZ", placeholder: "e.g., 82 123 4567" },
        { name: "Myanmar", code: "+95", iso2: "MM", placeholder: "e.g., 9 123 45678" },
        { name: "Namibia", code: "+264", iso2: "NA", placeholder: "e.g., 81 123 4567" },
        { name: "Nepal", code: "+977", iso2: "NP", placeholder: "e.g., 98012 34567" },
        { name: "Netherlands", code: "+31", iso2: "NL", placeholder: "e.g., 6 1234 5678" },
        { name: "New Zealand", code: "+64", iso2: "NZ", placeholder: "e.g., 21 123 4567" },
        { name: "Nicaragua", code: "+505", iso2: "NI", placeholder: "e.g., 8888 1234" },
        { name: "Niger", code: "+227", iso2: "NE", placeholder: "e.g., 90 12 34 56" },
        { name: "Nigeria", code: "+234", iso2: "NG", placeholder: "e.g., 8012345678" },
        { name: "North Korea", code: "+850", iso2: "KP", placeholder: "e.g., 191 123 456" },
        { name: "North Macedonia", code: "+389", iso2: "MK", placeholder: "e.g., 70 123 456" },
        { name: "Norway", code: "+47", iso2: "NO", placeholder: "e.g., 400 12 345" },
        { name: "Oman", code: "+968", iso2: "OM", placeholder: "e.g., 92 12 34 56" },
        { name: "Pakistan", code: "+92", iso2: "PK", placeholder: "e.g., 300 1234567" },
        { name: "Palestine", code: "+970", iso2: "PS", placeholder: "e.g., 59 123 4567" },
        { name: "Panama", code: "+507", iso2: "PA", placeholder: "e.g., 6000 1234" },
        { name: "Papua New Guinea", code: "+675", iso2: "PG", placeholder: "e.g., 70 123 456" },
        { name: "Paraguay", code: "+595", iso2: "PY", placeholder: "e.g., 981 123 456" },
        { name: "Peru", code: "+51", iso2: "PE", placeholder: "e.g., 999 123 456" },
        { name: "Philippines", code: "+63", iso2: "PH", placeholder: "e.g., 917 123 4567" },
        { name: "Poland", code: "+48", iso2: "PL", placeholder: "e.g., 501 123 456" },
        { name: "Portugal", code: "+351", iso2: "PT", placeholder: "e.g., 912 345 678" },
        { name: "Qatar", code: "+974", iso2: "QA", placeholder: "e.g., 5000 1234" },
        { name: "Romania", code: "+40", iso2: "RO", placeholder: "e.g., 721 123 456" },
        { name: "Russia", code: "+7", iso2: "RU", placeholder: "e.g., 903 123 4567" },
        { name: "Rwanda", code: "+250", iso2: "RW", placeholder: "e.g., 788 123 456" },
        { name: "Saudi Arabia", code: "+966", iso2: "SA", placeholder: "e.g., 50 123 4567" },
        { name: "Senegal", code: "+221", iso2: "SN", placeholder: "e.g., 77 123 45 67" },
        { name: "Serbia", code: "+381", iso2: "RS", placeholder: "e.g., 63 1234567" },
        { name: "Sierra Leone", code: "+232", iso2: "SL", placeholder: "e.g., 76 123456" },
        { name: "Singapore", code: "+65", iso2: "SG", placeholder: "e.g., 9123 4567" },
        { name: "Slovakia", code: "+421", iso2: "SK", placeholder: "e.g., 903 123 456" },
        { name: "Slovenia", code: "+386", iso2: "SI", placeholder: "e.g., 41 123 456" },
        { name: "Somalia", code: "+252", iso2: "SO", placeholder: "e.g., 61 123 4567" },
        { name: "South Africa", code: "+27", iso2: "ZA", placeholder: "e.g., 72 123 4567" },
        { name: "South Korea", code: "+82", iso2: "KR", placeholder: "e.g., 10 1234 5678" },
        { name: "South Sudan", code: "+211", iso2: "SS", placeholder: "e.g., 912 123 456" },
        { name: "Spain", code: "+34", iso2: "ES", placeholder: "e.g., 600 12 34 56" },
        { name: "Sri Lanka", code: "+94", iso2: "LK", placeholder: "e.g., 77 123 4567" },
        { name: "Sudan", code: "+249", iso2: "SD", placeholder: "e.g., 912 123 456" },
        { name: "Sweden", code: "+46", iso2: "SE", placeholder: "e.g., 70 123 45 67" },
        { name: "Switzerland", code: "+41", iso2: "CH", placeholder: "e.g., 79 123 45 67" },
        { name: "Syria", code: "+963", iso2: "SY", placeholder: "e.g., 99 123 4567" },
        { name: "Taiwan", code: "+886", iso2: "TW", placeholder: "e.g., 912 123 456" },
        { name: "Tajikistan", code: "+992", iso2: "TJ", placeholder: "e.g., 98 123 4567" },
        { name: "Tanzania", code: "+255", iso2: "TZ", placeholder: "e.g., 713 123 456" },
        { name: "Thailand", code: "+66", iso2: "TH", placeholder: "e.g., 81 123 4567" },
        { name: "Togo", code: "+228", iso2: "TG", placeholder: "e.g., 90 12 34 56" },
        { name: "Trinidad and Tobago", code: "+1-868", iso2: "TT", placeholder: "e.g., 868 123 4567" },
        { name: "Tunisia", code: "+216", iso2: "TN", placeholder: "e.g., 98 123 456" },
        { name: "Turkey", code: "+90", iso2: "TR", placeholder: "e.g., 532 123 45 67" },
        { name: "Turkmenistan", code: "+993", iso2: "TM", placeholder: "e.g., 61 12 34 56" },
        { name: "Uganda", code: "+256", iso2: "UG", placeholder: "e.g., 772 123 456" },
        { name: "Ukraine", code: "+380", iso2: "UA", placeholder: "e.g., 50 123 4567" },
        { name: "United Arab Emirates", code: "+971", iso2: "AE", placeholder: "e.g., 50 123 4567" },
        { name: "United Kingdom", code: "+44", iso2: "GB", placeholder: "e.g., 7700 900876" },
        { name: "United States", code: "+1", iso2: "US", placeholder: "e.g., (555) 123-4567" },
        { name: "Uruguay", code: "+598", iso2: "UY", placeholder: "e.g., 99 123 456" },
        { name: "Uzbekistan", code: "+998", iso2: "UZ", placeholder: "e.g., 90 123 4567" },
        { name: "Venezuela", code: "+58", iso2: "VE", placeholder: "e.g., 412 123 4567" },
        { name: "Vietnam", code: "+84", iso2: "VN", placeholder: "e.g., 912 123 456" },
        { name: "Yemen", code: "+967", iso2: "YE", placeholder: "e.g., 77 123 4567" },
        { name: "Zambia", code: "+260", iso2: "ZM", placeholder: "e.g., 97 123 4567" },
        { name: "Zimbabwe", code: "+263", iso2: "ZW", placeholder: "e.g., 77 123 4567" }
    ];

    // --- View Management Functions (Unchanged) ---
    function goToProfileView() {
        document.getElementById('profileView').classList.remove('hidden');
        document.getElementById('credentialsView').classList.add('hidden');
    }

    function goToCredentialsView() {
        document.getElementById('profileView').classList.add('hidden');
        document.getElementById('credentialsView').classList.remove('hidden');
    }

    // --- Modal Message Handler (Unchanged) ---
    function showModalMessage(title, message, isError = false, showData = false, dataContent = '') {
        const modal = document.getElementById('systemModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const finalDataContainer = document.getElementById('finalData');

        modalTitle.textContent = title;
        modalMessage.textContent = message;
        modalTitle.className = `text-2xl font-bold mb-4 ${isError ? 'text-red-600' : 'text-green-600'}`;
        
        if (showData) {
            finalDataContainer.innerHTML = dataContent;
            finalDataContainer.classList.remove('hidden');
        } else {
            finalDataContainer.classList.add('hidden');
        }

        modal.style.display = 'flex';
    }


    // --- Utility Function to Handle Tag Toggling (Unchanged) ---
    function setupTagToggle(containerId, list, dataSet) {
        const container = document.getElementById(containerId);
        list.forEach(item => {
            const tag = document.createElement('span');
            tag.innerText = item;
            tag.classList.add('tag');

            tag.addEventListener('click', () => {
                tag.classList.toggle('selected');
                if (tag.classList.contains('selected')) {
                    dataSet.add(item);
                } else {
                    dataSet.delete(item);
                }
            });
            container.appendChild(tag);
        });
    }

    // --- Tag Data Lists (Unchanged) ---
    const hobbiesList = [
        "Personal","Fitness","Health","Wellness","Fashion","Beauty","Travel","Photography",
        "Music","Movies","Television","Gaming","Art","Crafts","Technology","Coding",
        "Science","Mathematics","Reading","Writing","Blogging","Vlogging","Food","Cooking",
        "Baking","Gardening","Home Decor","Pets","Animals","Adventure","Sports","Football",
        "Basketball","Tennis","Yoga","Meditation","Spirituality","Religion","Politics",
        "Current Events","Finance","Investing","Cryptocurrency","Business","Entrepreneurship",
        "Marketing","Social Media","Memes","Quotes","Motivation","Lifestyle","Education",
        "Languages","Culture","History","Volunteering","Community","Networking","Events",
        "Cars","Motorcycles","Boating","Hiking","Camping","Fitness Challenges","Collectibles",
        "Board Games","Puzzles","Science Fiction","Fantasy","Comedy","Drama","Romance",
        "Action","Documentaries","Nature","Environment","DIY Projects","Shopping",
        "Luxury","Minimalism","Self-improvement","Meditation","Journaling","Adventure Sports",
        "Photography","Videography","Street Art","Museums","Exhibitions"
    ];

    const servicesList = [
        "Shoes","Fruits & Vegetables","Beverages","Fashion Accessories","Catering",
        "Hair/Beauty Services","Event Planning","Logistics","Tutoring / Lessons",
        "Therapy / Counseling","Electronics","Printing / Design Services",
        "Fitness / Personal Training","Other"
    ];

    const friendsList = [
        "Marriage / Godly Relationship","Business Purposes","Learning / Education",
        "Religious Purposes","Friendship / Networking","Sports / Team Activities",
        "Events / Celebrations","Travel / Tours","Health / Wellness",
        "Evangelism Purposes","Other"
    ];
    
    // --- Location Dropdown Management Functions (UPDATED) ---
    const countrySelect = document.getElementById('country');
    const stateSelect = document.getElementById('state');
    const citySelect = document.getElementById('city');
    
    function resetStates() {
        stateSelect.innerHTML = '<option value="">Select State/Region</option>';
        stateSelect.disabled = true;
        resetCities();
    }

    function resetCities() {
        citySelect.innerHTML = '<option value="">Select City/Town</option>';
        citySelect.disabled = true;
    }
    
    // Loads the full data file from R2
    async function loadLocationData() {
        try {
            const response = await fetch(R2_URL);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            locationData = await response.json();
            // console.log("Location data loaded successfully:", locationData.length, "countries");
            populateCountries();
        } catch (error) {
            console.error("Failed to load location data from R2:", error);
            countrySelect.innerHTML = '<option value="">Error Loading Data</option>';
            showModalMessage('Data Load Error', 'Failed to load location data from Cloudflare R2. Please check the network or R2 bucket configuration.', true);
        }
    }

    function populateCountries() {
        countrySelect.innerHTML = '<option value="">Select Country</option>';
        
        // Use the loaded data to populate the countries
        locationData.sort((a, b) => a.name.localeCompare(b.name)).forEach(country => {
            const option = document.createElement('option');
            option.value = country.name;
            option.text = country.name;
            countrySelect.appendChild(option);
        });
        countrySelect.disabled = false;
    }

    function populateStates(countryName) {
        resetStates();
        
        // Find the selected country object
        const country = locationData.find(c => c.name === countryName);
        
        if (!country || !country.states || country.states.length === 0) {
            stateSelect.innerHTML = '<option value="N/A">No States/Regions Found (Select this)</option>';
            stateSelect.disabled = false;
            return;
        }

        selectedCountryStates = country.states; // Store the state objects for city lookup
        
        stateSelect.disabled = false;
        
        // Populate states from the country object
        const stateNames = selectedCountryStates.map(s => s.name).sort();
        stateNames.forEach(stateName => {
            const option = document.createElement('option');
            option.value = stateName;
            option.text = stateName;
            stateSelect.appendChild(option);
        });
    }

    function populateCities(stateName) {
        resetCities();
        
        // Find the selected state object within the stored country states
        const state = selectedCountryStates.find(s => s.name === stateName);
        
        if (!state || !state.cities || state.cities.length === 0) {
            citySelect.innerHTML = '<option value="N/A">No Cities Found (Select this)</option>';
            citySelect.disabled = false;
            return;
        }

        citySelect.disabled = false;
        
        // Populate cities from the state object
        const cityNames = state.cities.map(c => c.name).sort();
        cityNames.forEach(cityName => {
            const option = document.createElement('option');
            option.value = cityName;
            option.text = cityName;
            citySelect.appendChild(option);
        });
    }

    // --- Initialization on Load ---
    window.onload = function() {
        
        // Start loading the location data immediately
        loadLocationData(); 

        const codeSelect = document.getElementById('countryCode');
        const numberInput = document.getElementById('whatsappNumber');
        
        // --- Setup Phone Codes (Unchanged) ---
        phoneCodes.forEach(item => {
            const option = document.createElement('option');
            option.text = `${item.name} (${item.code})`; 
            option.value = item.code; 
            option.setAttribute('data-placeholder', item.placeholder); 
            codeSelect.appendChild(option);
        });

        codeSelect.addEventListener('change', () => {
            const selectedOption = codeSelect.options[codeSelect.selectedIndex];
            const newPlaceholder = selectedOption.getAttribute('data-placeholder') || 'Enter local number';
            numberInput.placeholder = newPlaceholder;
        });
        codeSelect.dispatchEvent(new Event('change'));

        // --- Setup Age Options (Unchanged) ---
        const ageSelect = document.getElementById('age');
        for (let i = 18; i <= 100; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.text = i;
            ageSelect.appendChild(option);
        }
        
        // --- Setup Location Dropdown Listeners (UPDATED) ---
        // Note: populateCountries is now called inside loadLocationData()
        countrySelect.addEventListener('change', () => populateStates(countrySelect.value));
        stateSelect.addEventListener('change', () => populateCities(stateSelect.value));

        // --- Setup Tags (Unchanged) ---
        setupTagToggle('hobbiesContainer', hobbiesList, selectedHobbies);
        setupTagToggle('customersContainer', servicesList, selectedServices);
        setupTagToggle('friendsContainer', friendsList, selectedFriends);

        // --- Setup Form 1 Submission (Profile Data) (Unchanged) ---
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Collect and combine WhatsApp Number
            const countryCode = document.getElementById('countryCode').value;
            const localNumber = document.getElementById('whatsappNumber').value.trim();
            
            if (!countryCode || !localNumber) {
                 showModalMessage('Validation Error','Please select a Country Code and enter a Phone Number.', true);
                return;
            }

            // Simple validation for location fields
             if (!countrySelect.value || !stateSelect.value || !citySelect.value) {
                showModalMessage('Validation Error','Please select a Country, State/Region, and City/Town.',true);
                return;
            }

            const cleanLocalNumber = localNumber.replace(/\D/g, ''); 
            const fullWhatsappNumber = countryCode + cleanLocalNumber;

            // Collect profile data
            profileData = {
                'whatsapp_number': fullWhatsappNumber, 
                'full_name': document.getElementById('fullname').value.trim(),
                'nickname': document.getElementById('nickname').value.trim(),
                'profession': document.getElementById('profession').value.trim(), 
                'age': document.getElementById('age').value,
                'gender': document.getElementById('gender').value,
                'country': countrySelect.value,
                'state': stateSelect.value,
                'city': citySelect.value,
                // Store tag data separately for submission
                'hobbies': Array.from(selectedHobbies),
                'services': Array.from(selectedServices),
                'friend_reasons': Array.from(selectedFriends)
            };

            goToCredentialsView();
        });

        // --- Setup Form 2 Submission (Credentials Data) (Unchanged) ---
        document.getElementById('credentialsForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            const finalSubmission = {
                ...profileData,
                email: email,
                password: password 
            };
            
            showModalMessage(
                '✅ Account Created!',
                'Profile and Credentials collected. The next step is to set up your database before this data can be saved securely.',
                false,
                true,
                JSON.stringify(finalSubmission, null, 2)
            );
        });

    };
</script>

</body>
</html>
